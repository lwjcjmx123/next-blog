---
title: "ä»é›¶æ„å»ºReactç»„ä»¶åº“ï¼šè®¾è®¡ç³»ç»Ÿä¸å·¥ç¨‹åŒ–å®è·µ"
slug: "react-component-library-from-scratch"
excerpt: "è¯¦ç»†ä»‹ç»å¦‚ä½•ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªå®Œæ•´çš„Reactç»„ä»¶åº“ï¼ŒåŒ…æ‹¬è®¾è®¡ç³»ç»Ÿè§„åˆ’ã€ç»„ä»¶å¼€å‘ã€æ–‡æ¡£ç”Ÿæˆã€æµ‹è¯•ç­–ç•¥å’Œå‘å¸ƒæµç¨‹ã€‚"
date: "2024-03-10"
published: true
category: "å®æˆ˜é¡¹ç›®"
tags: ["React", "ç»„ä»¶åº“", "TypeScript"]
author: "hailong"
readingTime: 20
---

## å¼•è¨€

åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œç»„ä»¶åº“å·²æˆä¸ºæé«˜å¼€å‘æ•ˆç‡ã€ä¿è¯è®¾è®¡ä¸€è‡´æ€§çš„é‡è¦å·¥å…·ã€‚ä¸€ä¸ªä¼˜ç§€çš„ç»„ä»¶åº“ä¸ä»…èƒ½å¤Ÿå¤ç”¨ä»£ç ï¼Œæ›´èƒ½å»ºç«‹ç»Ÿä¸€çš„è®¾è®¡è¯­è¨€ï¼Œæå‡å›¢é˜Ÿåä½œæ•ˆç‡ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªå®Œæ•´çš„Reactç»„ä»¶åº“ã€‚

## é¡¹ç›®è§„åˆ’ä¸æ¶æ„è®¾è®¡

### 1. æŠ€æœ¯æ ˆé€‰æ‹©

æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹æŠ€æœ¯æ ˆæ¥æ„å»ºç»„ä»¶åº“ï¼š

```json
{
  "æ ¸å¿ƒæŠ€æœ¯": {
    "React": "^18.0.0",
    "TypeScript": "^4.9.0",
    "Styled-components": "^5.3.0"
  },
  "æ„å»ºå·¥å…·": {
    "Rollup": "^3.0.0",
    "Babel": "^7.20.0",
    "PostCSS": "^8.4.0"
  },
  "å¼€å‘å·¥å…·": {
    "Storybook": "^6.5.0",
    "Jest": "^29.0.0",
    "React Testing Library": "^13.0.0",
    "Chromatic": "^6.0.0"
  },
  "ä»£ç è´¨é‡": {
    "ESLint": "^8.0.0",
    "Prettier": "^2.8.0",
    "Husky": "^8.0.0",
    "Lint-staged": "^13.0.0"
  }
}
```

### 2. é¡¹ç›®ç»“æ„è®¾è®¡

```
my-ui-library/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/                 # æ ¸å¿ƒç»„ä»¶åŒ…
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/   # ç»„ä»¶æºç 
â”‚   â”‚   â”‚   â”œâ”€â”€ tokens/       # è®¾è®¡ä»¤ç‰Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/        # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ index.ts      # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ rollup.config.js
â”‚   â”œâ”€â”€ icons/                # å›¾æ ‡åŒ…
â”‚   â””â”€â”€ themes/               # ä¸»é¢˜åŒ…
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ storybook/            # Storybookæ–‡æ¡£
â”‚   â””â”€â”€ playground/           # æµ‹è¯•åº”ç”¨
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ build/                # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ eslint-config/        # ESLinté…ç½®
â”‚   â””â”€â”€ jest-config/          # Jesté…ç½®
â”œâ”€â”€ docs/                     # æ–‡æ¡£
â”œâ”€â”€ .github/                  # GitHub Actions
â”œâ”€â”€ package.json              # æ ¹package.json
â”œâ”€â”€ lerna.json                # Lernaé…ç½®
â””â”€â”€ tsconfig.json             # TypeScripté…ç½®
```

### 3. è®¾è®¡ç³»ç»Ÿè§„åˆ’

```typescript
// packages/core/src/tokens/index.ts
export const designTokens = {
  // é¢œè‰²ç³»ç»Ÿ
  colors: {
    primary: {
      50: '#f0f9ff',
      100: '#e0f2fe',
      200: '#bae6fd',
      300: '#7dd3fc',
      400: '#38bdf8',
      500: '#0ea5e9',
      600: '#0284c7',
      700: '#0369a1',
      800: '#075985',
      900: '#0c4a6e'
    },
    gray: {
      50: '#f9fafb',
      100: '#f3f4f6',
      200: '#e5e7eb',
      300: '#d1d5db',
      400: '#9ca3af',
      500: '#6b7280',
      600: '#4b5563',
      700: '#374151',
      800: '#1f2937',
      900: '#111827'
    },
    semantic: {
      success: '#10b981',
      warning: '#f59e0b',
      error: '#ef4444',
      info: '#3b82f6'
    }
  },
  
  // é—´è·ç³»ç»Ÿ
  spacing: {
    0: '0',
    1: '0.25rem',
    2: '0.5rem',
    3: '0.75rem',
    4: '1rem',
    5: '1.25rem',
    6: '1.5rem',
    8: '2rem',
    10: '2.5rem',
    12: '3rem',
    16: '4rem',
    20: '5rem',
    24: '6rem'
  },
  
  // å­—ä½“ç³»ç»Ÿ
  typography: {
    fontFamily: {
      sans: ['Inter', 'system-ui', 'sans-serif'],
      mono: ['Fira Code', 'monospace']
    },
    fontSize: {
      xs: ['0.75rem', { lineHeight: '1rem' }],
      sm: ['0.875rem', { lineHeight: '1.25rem' }],
      base: ['1rem', { lineHeight: '1.5rem' }],
      lg: ['1.125rem', { lineHeight: '1.75rem' }],
      xl: ['1.25rem', { lineHeight: '1.75rem' }],
      '2xl': ['1.5rem', { lineHeight: '2rem' }],
      '3xl': ['1.875rem', { lineHeight: '2.25rem' }],
      '4xl': ['2.25rem', { lineHeight: '2.5rem' }]
    },
    fontWeight: {
      normal: '400',
      medium: '500',
      semibold: '600',
      bold: '700'
    }
  },
  
  // é˜´å½±ç³»ç»Ÿ
  shadows: {
    sm: '0 1px 2px 0 rgb(0 0 0 / 0.05)',
    base: '0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)',
    md: '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)',
    lg: '0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)',
    xl: '0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)'
  },
  
  // è¾¹æ¡†åŠå¾„
  borderRadius: {
    none: '0',
    sm: '0.125rem',
    base: '0.25rem',
    md: '0.375rem',
    lg: '0.5rem',
    xl: '0.75rem',
    '2xl': '1rem',
    full: '9999px'
  },
  
  // æ–­ç‚¹ç³»ç»Ÿ
  breakpoints: {
    sm: '640px',
    md: '768px',
    lg: '1024px',
    xl: '1280px',
    '2xl': '1536px'
  },
  
  // åŠ¨ç”»ç³»ç»Ÿ
  animation: {
    duration: {
      fast: '150ms',
      normal: '300ms',
      slow: '500ms'
    },
    easing: {
      linear: 'linear',
      easeIn: 'cubic-bezier(0.4, 0, 1, 1)',
      easeOut: 'cubic-bezier(0, 0, 0.2, 1)',
      easeInOut: 'cubic-bezier(0.4, 0, 0.2, 1)'
    }
  }
};

// ç±»å‹å®šä¹‰
export type DesignTokens = typeof designTokens;
export type ColorScale = keyof typeof designTokens.colors.primary;
export type SpacingScale = keyof typeof designTokens.spacing;
export type FontSize = keyof typeof designTokens.typography.fontSize;
```

## æ ¸å¿ƒç»„ä»¶å¼€å‘

### 1. Buttonç»„ä»¶å®ç°

```typescript
// packages/core/src/components/Button/Button.types.ts
import { ReactNode, ButtonHTMLAttributes } from 'react';

export interface ButtonProps extends Omit<ButtonHTMLAttributes<HTMLButtonElement>, 'size'> {
  /** æŒ‰é’®å†…å®¹ */
  children: ReactNode;
  /** æŒ‰é’®å˜ä½“ */
  variant?: 'primary' | 'secondary' | 'outline' | 'ghost' | 'danger';
  /** æŒ‰é’®å°ºå¯¸ */
  size?: 'sm' | 'md' | 'lg';
  /** æ˜¯å¦ä¸ºåŠ è½½çŠ¶æ€ */
  loading?: boolean;
  /** æ˜¯å¦ç¦ç”¨ */
  disabled?: boolean;
  /** æ˜¯å¦ä¸ºå…¨å®½ */
  fullWidth?: boolean;
  /** å·¦ä¾§å›¾æ ‡ */
  leftIcon?: ReactNode;
  /** å³ä¾§å›¾æ ‡ */
  rightIcon?: ReactNode;
  /** ç‚¹å‡»äº‹ä»¶å¤„ç†å™¨ */
  onClick?: (event: React.MouseEvent<HTMLButtonElement>) => void;
}
```

```typescript
// packages/core/src/components/Button/Button.styles.ts
import styled, { css } from 'styled-components';
import { designTokens } from '../../tokens';
import { ButtonProps } from './Button.types';

const getVariantStyles = (variant: ButtonProps['variant']) => {
  const { colors } = designTokens;
  
  switch (variant) {
    case 'primary':
      return css`
        background-color: ${colors.primary[500]};
        color: white;
        border: 1px solid ${colors.primary[500]};
        
        &:hover:not(:disabled) {
          background-color: ${colors.primary[600]};
          border-color: ${colors.primary[600]};
        }
        
        &:active:not(:disabled) {
          background-color: ${colors.primary[700]};
          border-color: ${colors.primary[700]};
        }
      `;
      
    case 'secondary':
      return css`
        background-color: ${colors.gray[100]};
        color: ${colors.gray[900]};
        border: 1px solid ${colors.gray[200]};
        
        &:hover:not(:disabled) {
          background-color: ${colors.gray[200]};
          border-color: ${colors.gray[300]};
        }
      `;
      
    case 'outline':
      return css`
        background-color: transparent;
        color: ${colors.primary[600]};
        border: 1px solid ${colors.primary[300]};
        
        &:hover:not(:disabled) {
          background-color: ${colors.primary[50]};
          border-color: ${colors.primary[400]};
        }
      `;
      
    case 'ghost':
      return css`
        background-color: transparent;
        color: ${colors.gray[700]};
        border: 1px solid transparent;
        
        &:hover:not(:disabled) {
          background-color: ${colors.gray[100]};
        }
      `;
      
    case 'danger':
      return css`
        background-color: ${colors.semantic.error};
        color: white;
        border: 1px solid ${colors.semantic.error};
        
        &:hover:not(:disabled) {
          background-color: #dc2626;
          border-color: #dc2626;
        }
      `;
      
    default:
      return getVariantStyles('primary');
  }
};

const getSizeStyles = (size: ButtonProps['size']) => {
  const { spacing, typography } = designTokens;
  
  switch (size) {
    case 'sm':
      return css`
        padding: ${spacing[2]} ${spacing[3]};
        font-size: ${typography.fontSize.sm[0]};
        line-height: ${typography.fontSize.sm[1].lineHeight};
      `;
      
    case 'md':
      return css`
        padding: ${spacing[3]} ${spacing[4]};
        font-size: ${typography.fontSize.base[0]};
        line-height: ${typography.fontSize.base[1].lineHeight};
      `;
      
    case 'lg':
      return css`
        padding: ${spacing[4]} ${spacing[6]};
        font-size: ${typography.fontSize.lg[0]};
        line-height: ${typography.fontSize.lg[1].lineHeight};
      `;
      
    default:
      return getSizeStyles('md');
  }
};

export const StyledButton = styled.button<ButtonProps>`
  /* åŸºç¡€æ ·å¼ */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: ${designTokens.spacing[2]};
  font-family: ${designTokens.typography.fontFamily.sans.join(', ')};
  font-weight: ${designTokens.typography.fontWeight.medium};
  border-radius: ${designTokens.borderRadius.md};
  transition: all ${designTokens.animation.duration.fast} ${designTokens.animation.easing.easeInOut};
  cursor: pointer;
  user-select: none;
  white-space: nowrap;
  
  /* ç„¦ç‚¹æ ·å¼ */
  &:focus {
    outline: none;
    box-shadow: 0 0 0 3px ${designTokens.colors.primary[200]};
  }
  
  /* ç¦ç”¨æ ·å¼ */
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  /* å˜ä½“æ ·å¼ */
  ${props => getVariantStyles(props.variant)}
  
  /* å°ºå¯¸æ ·å¼ */
  ${props => getSizeStyles(props.size)}
  
  /* å…¨å®½æ ·å¼ */
  ${props => props.fullWidth && css`
    width: 100%;
  `}
  
  /* åŠ è½½çŠ¶æ€ */
  ${props => props.loading && css`
    pointer-events: none;
  `}
`;

export const LoadingSpinner = styled.div`
  width: 1em;
  height: 1em;
  border: 2px solid transparent;
  border-top: 2px solid currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
`;

export const IconWrapper = styled.span`
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 1em;
  height: 1em;
`;
```

```typescript
// packages/core/src/components/Button/Button.tsx
import React, { forwardRef } from 'react';
import { ButtonProps } from './Button.types';
import { StyledButton, LoadingSpinner, IconWrapper } from './Button.styles';

export const Button = forwardRef<HTMLButtonElement, ButtonProps>(
  (
    {
      children,
      variant = 'primary',
      size = 'md',
      loading = false,
      disabled = false,
      fullWidth = false,
      leftIcon,
      rightIcon,
      onClick,
      ...rest
    },
    ref
  ) => {
    const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {
      if (loading || disabled) {
        event.preventDefault();
        return;
      }
      onClick?.(event);
    };

    return (
      <StyledButton
        ref={ref}
        variant={variant}
        size={size}
        fullWidth={fullWidth}
        loading={loading}
        disabled={disabled || loading}
        onClick={handleClick}
        {...rest}
      >
        {loading && <LoadingSpinner />}
        {!loading && leftIcon && <IconWrapper>{leftIcon}</IconWrapper>}
        {children}
        {!loading && rightIcon && <IconWrapper>{rightIcon}</IconWrapper>}
      </StyledButton>
    );
  }
);

Button.displayName = 'Button';
```

### 2. Inputç»„ä»¶å®ç°

```typescript
// packages/core/src/components/Input/Input.types.ts
import { InputHTMLAttributes, ReactNode } from 'react';

export interface InputProps extends Omit<InputHTMLAttributes<HTMLInputElement>, 'size'> {
  /** è¾“å…¥æ¡†æ ‡ç­¾ */
  label?: string;
  /** è¾“å…¥æ¡†å°ºå¯¸ */
  size?: 'sm' | 'md' | 'lg';
  /** é”™è¯¯çŠ¶æ€ */
  error?: boolean;
  /** é”™è¯¯ä¿¡æ¯ */
  errorMessage?: string;
  /** å¸®åŠ©æ–‡æœ¬ */
  helperText?: string;
  /** å·¦ä¾§å›¾æ ‡ */
  leftIcon?: ReactNode;
  /** å³ä¾§å›¾æ ‡ */
  rightIcon?: ReactNode;
  /** æ˜¯å¦å¿…å¡« */
  required?: boolean;
  /** æ˜¯å¦å…¨å®½ */
  fullWidth?: boolean;
}
```

```typescript
// packages/core/src/components/Input/Input.tsx
import React, { forwardRef, useId } from 'react';
import { InputProps } from './Input.types';
import {
  InputContainer,
  Label,
  InputWrapper,
  StyledInput,
  IconWrapper,
  HelperText,
  ErrorMessage
} from './Input.styles';

export const Input = forwardRef<HTMLInputElement, InputProps>(
  (
    {
      label,
      size = 'md',
      error = false,
      errorMessage,
      helperText,
      leftIcon,
      rightIcon,
      required = false,
      fullWidth = false,
      id,
      ...rest
    },
    ref
  ) => {
    const inputId = useId();
    const finalId = id || inputId;
    const helperId = `${finalId}-helper`;
    const errorId = `${finalId}-error`;

    return (
      <InputContainer fullWidth={fullWidth}>
        {label && (
          <Label htmlFor={finalId} required={required}>
            {label}
            {required && <span aria-label="required"> *</span>}
          </Label>
        )}
        
        <InputWrapper error={error} size={size}>
          {leftIcon && <IconWrapper position="left">{leftIcon}</IconWrapper>}
          
          <StyledInput
            ref={ref}
            id={finalId}
            size={size}
            error={error}
            hasLeftIcon={!!leftIcon}
            hasRightIcon={!!rightIcon}
            aria-describedby={
              error && errorMessage
                ? errorId
                : helperText
                ? helperId
                : undefined
            }
            aria-invalid={error}
            {...rest}
          />
          
          {rightIcon && <IconWrapper position="right">{rightIcon}</IconWrapper>}
        </InputWrapper>
        
        {error && errorMessage && (
          <ErrorMessage id={errorId} role="alert">
            {errorMessage}
          </ErrorMessage>
        )}
        
        {!error && helperText && (
          <HelperText id={helperId}>{helperText}</HelperText>
        )}
      </InputContainer>
    );
  }
);

Input.displayName = 'Input';
```

### 3. å¤åˆç»„ä»¶ï¼šModal

```typescript
// packages/core/src/components/Modal/Modal.tsx
import React, { useEffect, useRef, ReactNode } from 'react';
import { createPortal } from 'react-dom';
import { useScrollLock } from '../../hooks/useScrollLock';
import { useFocusTrap } from '../../hooks/useFocusTrap';
import {
  Overlay,
  ModalContainer,
  ModalContent,
  ModalHeader,
  ModalTitle,
  CloseButton,
  ModalBody,
  ModalFooter
} from './Modal.styles';

export interface ModalProps {
  /** æ˜¯å¦æ˜¾ç¤ºæ¨¡æ€æ¡† */
  open: boolean;
  /** å…³é—­æ¨¡æ€æ¡†çš„å›è°ƒ */
  onClose: () => void;
  /** æ¨¡æ€æ¡†æ ‡é¢˜ */
  title?: string;
  /** æ¨¡æ€æ¡†å†…å®¹ */
  children: ReactNode;
  /** åº•éƒ¨æ“ä½œåŒºåŸŸ */
  footer?: ReactNode;
  /** æ¨¡æ€æ¡†å°ºå¯¸ */
  size?: 'sm' | 'md' | 'lg' | 'xl';
  /** æ˜¯å¦æ˜¾ç¤ºå…³é—­æŒ‰é’® */
  showCloseButton?: boolean;
  /** ç‚¹å‡»é®ç½©æ˜¯å¦å…³é—­ */
  closeOnOverlayClick?: boolean;
  /** æŒ‰ESCæ˜¯å¦å…³é—­ */
  closeOnEscape?: boolean;
  /** è‡ªå®šä¹‰å®¹å™¨ */
  container?: Element;
}

export const Modal: React.FC<ModalProps> = ({
  open,
  onClose,
  title,
  children,
  footer,
  size = 'md',
  showCloseButton = true,
  closeOnOverlayClick = true,
  closeOnEscape = true,
  container
}) => {
  const modalRef = useRef<HTMLDivElement>(null);
  const previousActiveElement = useRef<Element | null>(null);
  
  // é”å®šæ»šåŠ¨
  useScrollLock(open);
  
  // ç„¦ç‚¹é™·é˜±
  useFocusTrap(modalRef, open);
  
  // å¤„ç†ESCé”®å…³é—­
  useEffect(() => {
    if (!open || !closeOnEscape) return;
    
    const handleEscape = (event: KeyboardEvent) => {
      if (event.key === 'Escape') {
        onClose();
      }
    };
    
    document.addEventListener('keydown', handleEscape);
    return () => document.removeEventListener('keydown', handleEscape);
  }, [open, closeOnEscape, onClose]);
  
  // ç®¡ç†ç„¦ç‚¹
  useEffect(() => {
    if (open) {
      previousActiveElement.current = document.activeElement;
    } else if (previousActiveElement.current) {
      (previousActiveElement.current as HTMLElement).focus?.();
    }
  }, [open]);
  
  // å¤„ç†é®ç½©ç‚¹å‡»
  const handleOverlayClick = (event: React.MouseEvent) => {
    if (closeOnOverlayClick && event.target === event.currentTarget) {
      onClose();
    }
  };
  
  if (!open) return null;
  
  const modalContent = (
    <Overlay onClick={handleOverlayClick}>
      <ModalContainer
        ref={modalRef}
        size={size}
        role="dialog"
        aria-modal="true"
        aria-labelledby={title ? 'modal-title' : undefined}
      >
        <ModalContent>
          {(title || showCloseButton) && (
            <ModalHeader>
              {title && (
                <ModalTitle id="modal-title">{title}</ModalTitle>
              )}
              {showCloseButton && (
                <CloseButton
                  onClick={onClose}
                  aria-label="å…³é—­æ¨¡æ€æ¡†"
                  type="button"
                >
                  Ã—
                </CloseButton>
              )}
            </ModalHeader>
          )}
          
          <ModalBody>{children}</ModalBody>
          
          {footer && <ModalFooter>{footer}</ModalFooter>}
        </ModalContent>
      </ModalContainer>
    </Overlay>
  );
  
  return createPortal(
    modalContent,
    container || document.body
  );
};
```

## å·¥å…·å‡½æ•°ä¸Hooks

### 1. è‡ªå®šä¹‰Hooks

```typescript
// packages/core/src/hooks/useScrollLock.ts
import { useEffect } from 'react';

export const useScrollLock = (lock: boolean) => {
  useEffect(() => {
    if (!lock) return;
    
    const originalStyle = window.getComputedStyle(document.body).overflow;
    document.body.style.overflow = 'hidden';
    
    return () => {
      document.body.style.overflow = originalStyle;
    };
  }, [lock]);
};
```

```typescript
// packages/core/src/hooks/useFocusTrap.ts
import { useEffect, RefObject } from 'react';

const FOCUSABLE_ELEMENTS = [
  'a[href]',
  'button:not([disabled])',
  'textarea:not([disabled])',
  'input:not([disabled])',
  'select:not([disabled])',
  '[tabindex]:not([tabindex="-1"])'
].join(', ');

export const useFocusTrap = (
  containerRef: RefObject<HTMLElement>,
  active: boolean
) => {
  useEffect(() => {
    if (!active || !containerRef.current) return;
    
    const container = containerRef.current;
    const focusableElements = container.querySelectorAll(FOCUSABLE_ELEMENTS);
    const firstElement = focusableElements[0] as HTMLElement;
    const lastElement = focusableElements[focusableElements.length - 1] as HTMLElement;
    
    const handleTabKey = (event: KeyboardEvent) => {
      if (event.key !== 'Tab') return;
      
      if (event.shiftKey) {
        if (document.activeElement === firstElement) {
          event.preventDefault();
          lastElement?.focus();
        }
      } else {
        if (document.activeElement === lastElement) {
          event.preventDefault();
          firstElement?.focus();
        }
      }
    };
    
    // åˆå§‹ç„¦ç‚¹
    firstElement?.focus();
    
    container.addEventListener('keydown', handleTabKey);
    
    return () => {
      container.removeEventListener('keydown', handleTabKey);
    };
  }, [active, containerRef]);
};
```

### 2. å·¥å…·å‡½æ•°

```typescript
// packages/core/src/utils/classNames.ts
export type ClassValue = string | number | boolean | undefined | null | ClassArray | ClassDictionary;

interface ClassDictionary {
  [id: string]: any;
}

interface ClassArray extends Array<ClassValue> {}

export function classNames(...classes: ClassValue[]): string {
  const result: string[] = [];
  
  for (const cls of classes) {
    if (!cls) continue;
    
    if (typeof cls === 'string' || typeof cls === 'number') {
      result.push(String(cls));
    } else if (Array.isArray(cls)) {
      const inner = classNames(...cls);
      if (inner) result.push(inner);
    } else if (typeof cls === 'object') {
      for (const key in cls) {
        if (cls[key]) result.push(key);
      }
    }
  }
  
  return result.join(' ');
}
```

```typescript
// packages/core/src/utils/responsive.ts
import { designTokens } from '../tokens';

export const createMediaQuery = (breakpoint: keyof typeof designTokens.breakpoints) => {
  return `@media (min-width: ${designTokens.breakpoints[breakpoint]})`;
};

export const useMediaQuery = (query: string): boolean => {
  const [matches, setMatches] = useState(false);
  
  useEffect(() => {
    const media = window.matchMedia(query);
    setMatches(media.matches);
    
    const listener = (event: MediaQueryListEvent) => {
      setMatches(event.matches);
    };
    
    media.addEventListener('change', listener);
    return () => media.removeEventListener('change', listener);
  }, [query]);
  
  return matches;
};

export const useBreakpoint = () => {
  const isSm = useMediaQuery(createMediaQuery('sm').replace('@media ', ''));
  const isMd = useMediaQuery(createMediaQuery('md').replace('@media ', ''));
  const isLg = useMediaQuery(createMediaQuery('lg').replace('@media ', ''));
  const isXl = useMediaQuery(createMediaQuery('xl').replace('@media ', ''));
  const is2xl = useMediaQuery(createMediaQuery('2xl').replace('@media ', ''));
  
  return {
    isSm,
    isMd,
    isLg,
    isXl,
    is2xl,
    current: is2xl ? '2xl' : isXl ? 'xl' : isLg ? 'lg' : isMd ? 'md' : isSm ? 'sm' : 'xs'
  };
};
```

## æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

```typescript
// packages/core/src/components/Button/Button.test.tsx
import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import { ThemeProvider } from 'styled-components';
import { Button } from './Button';
import { designTokens } from '../../tokens';

const renderWithTheme = (component: React.ReactElement) => {
  return render(
    <ThemeProvider theme={designTokens}>
      {component}
    </ThemeProvider>
  );
};

describe('Button', () => {
  it('renders correctly', () => {
    renderWithTheme(<Button>Click me</Button>);
    expect(screen.getByRole('button', { name: 'Click me' })).toBeInTheDocument();
  });
  
  it('handles click events', () => {
    const handleClick = jest.fn();
    renderWithTheme(<Button onClick={handleClick}>Click me</Button>);
    
    fireEvent.click(screen.getByRole('button'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });
  
  it('shows loading state', () => {
    renderWithTheme(<Button loading>Loading</Button>);
    
    const button = screen.getByRole('button');
    expect(button).toBeDisabled();
    expect(button).toHaveStyle('pointer-events: none');
  });
  
  it('renders with different variants', () => {
    const { rerender } = renderWithTheme(<Button variant="primary">Primary</Button>);
    expect(screen.getByRole('button')).toHaveStyle(`background-color: ${designTokens.colors.primary[500]}`);
    
    rerender(
      <ThemeProvider theme={designTokens}>
        <Button variant="secondary">Secondary</Button>
      </ThemeProvider>
    );
    expect(screen.getByRole('button')).toHaveStyle(`background-color: ${designTokens.colors.gray[100]}`);
  });
  
  it('renders with icons', () => {
    const leftIcon = <span data-testid="left-icon">â†</span>;
    const rightIcon = <span data-testid="right-icon">â†’</span>;
    
    renderWithTheme(
      <Button leftIcon={leftIcon} rightIcon={rightIcon}>
        With Icons
      </Button>
    );
    
    expect(screen.getByTestId('left-icon')).toBeInTheDocument();
    expect(screen.getByTestId('right-icon')).toBeInTheDocument();
  });
  
  it('supports accessibility features', () => {
    renderWithTheme(
      <Button disabled aria-label="Disabled button">
        Disabled
      </Button>
    );
    
    const button = screen.getByRole('button');
    expect(button).toBeDisabled();
    expect(button).toHaveAttribute('aria-label', 'Disabled button');
  });
});
```

### 2. é›†æˆæµ‹è¯•

```typescript
// packages/core/src/components/Modal/Modal.test.tsx
import React, { useState } from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { Modal } from './Modal';
import { Button } from '../Button';

const ModalTestComponent = () => {
  const [open, setOpen] = useState(false);
  
  return (
    <>
      <Button onClick={() => setOpen(true)}>Open Modal</Button>
      <Modal
        open={open}
        onClose={() => setOpen(false)}
        title="Test Modal"
        footer={
          <>
            <Button variant="secondary" onClick={() => setOpen(false)}>
              Cancel
            </Button>
            <Button onClick={() => setOpen(false)}>Confirm</Button>
          </>
        }
      >
        <p>Modal content</p>
      </Modal>
    </>
  );
};

describe('Modal Integration', () => {
  it('opens and closes modal correctly', async () => {
    const user = userEvent.setup();
    render(<ModalTestComponent />);
    
    // åˆå§‹çŠ¶æ€ï¼šæ¨¡æ€æ¡†ä¸å¯è§
    expect(screen.queryByRole('dialog')).not.toBeInTheDocument();
    
    // æ‰“å¼€æ¨¡æ€æ¡†
    await user.click(screen.getByText('Open Modal'));
    expect(screen.getByRole('dialog')).toBeInTheDocument();
    expect(screen.getByText('Test Modal')).toBeInTheDocument();
    expect(screen.getByText('Modal content')).toBeInTheDocument();
    
    // å…³é—­æ¨¡æ€æ¡†
    await user.click(screen.getByText('Cancel'));
    expect(screen.queryByRole('dialog')).not.toBeInTheDocument();
  });
  
  it('handles keyboard navigation', async () => {
    const user = userEvent.setup();
    render(<ModalTestComponent />);
    
    await user.click(screen.getByText('Open Modal'));
    
    // ESCé”®å…³é—­
    await user.keyboard('{Escape}');
    expect(screen.queryByRole('dialog')).not.toBeInTheDocument();
  });
  
  it('traps focus within modal', async () => {
    const user = userEvent.setup();
    render(<ModalTestComponent />);
    
    await user.click(screen.getByText('Open Modal'));
    
    const cancelButton = screen.getByText('Cancel');
    const confirmButton = screen.getByText('Confirm');
    const closeButton = screen.getByLabelText('å…³é—­æ¨¡æ€æ¡†');
    
    // Tabå¾ªç¯
    await user.tab();
    expect(closeButton).toHaveFocus();
    
    await user.tab();
    expect(cancelButton).toHaveFocus();
    
    await user.tab();
    expect(confirmButton).toHaveFocus();
    
    await user.tab();
    expect(closeButton).toHaveFocus(); // å›åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ 
  });
});
```

## Storybookæ–‡æ¡£

### 1. Button Stories

```typescript
// apps/storybook/src/stories/Button.stories.tsx
import type { Meta, StoryObj } from '@storybook/react';
import { Button } from '@my-ui/core';
import { action } from '@storybook/addon-actions';

const meta: Meta<typeof Button> = {
  title: 'Components/Button',
  component: Button,
  parameters: {
    layout: 'centered',
    docs: {
      description: {
        component: 'æŒ‰é’®ç»„ä»¶ç”¨äºè§¦å‘æ“ä½œå’Œå¯¼èˆªã€‚æ”¯æŒå¤šç§å˜ä½“ã€å°ºå¯¸å’ŒçŠ¶æ€ã€‚'
      }
    }
  },
  argTypes: {
    variant: {
      control: 'select',
      options: ['primary', 'secondary', 'outline', 'ghost', 'danger'],
      description: 'æŒ‰é’®çš„è§†è§‰å˜ä½“'
    },
    size: {
      control: 'select',
      options: ['sm', 'md', 'lg'],
      description: 'æŒ‰é’®çš„å°ºå¯¸'
    },
    loading: {
      control: 'boolean',
      description: 'æ˜¯å¦æ˜¾ç¤ºåŠ è½½çŠ¶æ€'
    },
    disabled: {
      control: 'boolean',
      description: 'æ˜¯å¦ç¦ç”¨æŒ‰é’®'
    },
    fullWidth: {
      control: 'boolean',
      description: 'æ˜¯å¦å æ»¡å®¹å™¨å®½åº¦'
    }
  },
  args: {
    onClick: action('clicked')
  }
};

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {
  args: {
    children: 'Button'
  }
};

export const Variants: Story = {
  render: () => (
    <div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap' }}>
      <Button variant="primary">Primary</Button>
      <Button variant="secondary">Secondary</Button>
      <Button variant="outline">Outline</Button>
      <Button variant="ghost">Ghost</Button>
      <Button variant="danger">Danger</Button>
    </div>
  ),
  parameters: {
    docs: {
      description: {
        story: 'æŒ‰é’®æ”¯æŒå¤šç§è§†è§‰å˜ä½“ï¼Œé€‚ç”¨äºä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚'
      }
    }
  }
};

export const Sizes: Story = {
  render: () => (
    <div style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>
      <Button size="sm">Small</Button>
      <Button size="md">Medium</Button>
      <Button size="lg">Large</Button>
    </div>
  )
};

export const WithIcons: Story = {
  render: () => (
    <div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap' }}>
      <Button leftIcon={<span>ğŸ“</span>}>With Left Icon</Button>
      <Button rightIcon={<span>â†’</span>}>With Right Icon</Button>
      <Button leftIcon={<span>ğŸ“</span>} rightIcon={<span>â†’</span>}>
        With Both Icons
      </Button>
    </div>
  )
};

export const States: Story = {
  render: () => (
    <div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap' }}>
      <Button>Normal</Button>
      <Button loading>Loading</Button>
      <Button disabled>Disabled</Button>
    </div>
  )
};

export const FullWidth: Story = {
  render: () => (
    <div style={{ width: '300px' }}>
      <Button fullWidth>Full Width Button</Button>
    </div>
  )
};
```

### 2. Storybooké…ç½®

```typescript
// apps/storybook/.storybook/main.ts
import type { StorybookConfig } from '@storybook/react-vite';

const config: StorybookConfig = {
  stories: ['../src/**/*.stories.@(js|jsx|ts|tsx|mdx)'],
  addons: [
    '@storybook/addon-essentials',
    '@storybook/addon-interactions',
    '@storybook/addon-a11y',
    '@storybook/addon-docs',
    '@storybook/addon-controls',
    '@storybook/addon-viewport'
  ],
  framework: {
    name: '@storybook/react-vite',
    options: {}
  },
  typescript: {
    check: false,
    reactDocgen: 'react-docgen-typescript',
    reactDocgenTypescriptOptions: {
      shouldExtractLiteralValuesFromEnum: true,
      propFilter: (prop) => (prop.parent ? !/node_modules/.test(prop.parent.fileName) : true)
    }
  },
  docs: {
    autodocs: 'tag'
  }
};

export default config;
```

## æ„å»ºä¸å‘å¸ƒ

### 1. Rollupé…ç½®

```javascript
// packages/core/rollup.config.js
import resolve from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
import typescript from '@rollup/plugin-typescript';
import { terser } from 'rollup-plugin-terser';
import peerDepsExternal from 'rollup-plugin-peer-deps-external';
import postcss from 'rollup-plugin-postcss';

const packageJson = require('./package.json');

export default {
  input: 'src/index.ts',
  output: [
    {
      file: packageJson.main,
      format: 'cjs',
      sourcemap: true
    },
    {
      file: packageJson.module,
      format: 'esm',
      sourcemap: true
    }
  ],
  plugins: [
    peerDepsExternal(),
    resolve({
      browser: true
    }),
    commonjs(),
    typescript({
      tsconfig: './tsconfig.json',
      exclude: ['**/*.test.tsx', '**/*.test.ts', '**/*.stories.tsx']
    }),
    postcss({
      extract: false,
      modules: false,
      use: ['sass']
    }),
    terser()
  ],
  external: ['react', 'react-dom', 'styled-components']
};
```

### 2. å‘å¸ƒè„šæœ¬

```json
{
  "scripts": {
    "build": "rollup -c",
    "build:watch": "rollup -c -w",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "lint": "eslint src --ext .ts,.tsx",
    "lint:fix": "eslint src --ext .ts,.tsx --fix",
    "type-check": "tsc --noEmit",
    "storybook": "start-storybook -p 6006",
    "build-storybook": "build-storybook",
    "prepublishOnly": "npm run build",
    "release": "semantic-release"
  }
}
```

### 3. CI/CDé…ç½®

```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [16.x, 18.x]
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run linting
        run: npm run lint
      
      - name: Run type checking
        run: npm run type-check
      
      - name: Run tests
        run: npm run test:coverage
      
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
      
      - name: Build packages
        run: npm run build
      
      - name: Build Storybook
        run: npm run build-storybook
      
      - name: Visual regression testing
        run: npx chromatic --project-token=${{ secrets.CHROMATIC_PROJECT_TOKEN }}
        if: github.event_name == 'push'

  release:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18.x'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build packages
        run: npm run build
      
      - name: Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
        run: npm run release
```

## æ€»ç»“

é€šè¿‡æœ¬æ–‡çš„è¯¦ç»†ä»‹ç»ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„Reactç»„ä»¶åº“çš„æ„å»ºï¼Œæ¶µç›–äº†ï¼š

### æ ¸å¿ƒç‰¹æ€§
1. **è®¾è®¡ç³»ç»Ÿ**ï¼šå»ºç«‹äº†å®Œæ•´çš„è®¾è®¡ä»¤ç‰Œä½“ç³»
2. **ç»„ä»¶å¼€å‘**ï¼šå®ç°äº†å¯å¤ç”¨ã€å¯è®¿é—®çš„ç»„ä»¶
3. **ç±»å‹å®‰å…¨**ï¼šå…¨é¢çš„TypeScriptæ”¯æŒ
4. **æµ‹è¯•è¦†ç›–**ï¼šå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
5. **æ–‡æ¡£ç”Ÿæˆ**ï¼šStorybookäº¤äº’å¼æ–‡æ¡£
6. **æ„å»ºä¼˜åŒ–**ï¼šç°ä»£åŒ–çš„æ„å»ºå’Œå‘å¸ƒæµç¨‹

### æœ€ä½³å®è·µ
1. **å¯è®¿é—®æ€§ä¼˜å…ˆ**ï¼šéµå¾ªWCAGæŒ‡å—
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šTree-shakingå’ŒæŒ‰éœ€åŠ è½½
3. **å¼€å‘ä½“éªŒ**ï¼šå®Œå–„çš„å¼€å‘å·¥å…·é“¾
4. **è´¨é‡ä¿è¯**ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•å’Œä»£ç æ£€æŸ¥

### æ‰©å±•æ–¹å‘
1. **ä¸»é¢˜ç³»ç»Ÿ**ï¼šæ”¯æŒå¤šä¸»é¢˜åˆ‡æ¢
2. **å›½é™…åŒ–**ï¼šå¤šè¯­è¨€æ”¯æŒ
3. **ç§»åŠ¨ç«¯é€‚é…**ï¼šå“åº”å¼è®¾è®¡
4. **æ€§èƒ½ç›‘æ§**ï¼šè¿è¡Œæ—¶æ€§èƒ½åˆ†æ

æ„å»ºç»„ä»¶åº“æ˜¯ä¸€ä¸ªæŒç»­è¿­ä»£çš„è¿‡ç¨‹ï¼Œéœ€è¦æ ¹æ®å®é™…ä½¿ç”¨åé¦ˆä¸æ–­ä¼˜åŒ–å’Œå®Œå–„ã€‚é€šè¿‡å»ºç«‹å®Œå–„çš„å¼€å‘æµç¨‹å’Œè´¨é‡ä¿è¯æœºåˆ¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ„å»ºå‡ºé«˜è´¨é‡ã€æ˜“ç»´æŠ¤çš„ç»„ä»¶åº“ï¼Œä¸ºå›¢é˜Ÿå¼€å‘æ•ˆç‡çš„æå‡å¥ å®šåšå®åŸºç¡€ã€‚